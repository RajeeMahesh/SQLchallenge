Data Mart is Danny’s latest venture and after running international operations for his online supermarket that specialises in fresh produce - Danny is asking for your support to analyse his sales performance.

In June 2020 - large scale supply changes were made at Data Mart. All Data Mart products now use sustainable packaging methods in every single step from the farm all the way to the customer.

Danny needs your help to quantify the impact of this change on the sales performance for Data Mart and it’s separate business areas.

The key business question he wants you to help him answer are the following:

What was the quantifiable impact of the changes introduced in June 2020?
Which platform, region, segment and customer types were the most impacted by this change?
What can we do about future introduction of similar sustainability updates to the business to minimise impact on sales?

Casestudy link : https://8weeksqlchallenge.com/case-study-5/

A) Data Cleansing Steps
with clean_weekly_sales as 
    (select week_date, extract(week from week_date) as week_no,
    extract(month from week_date) as month_no, extract(year from week_date) as calender_year, 
    region, platform,
            (case when segment is null or segment like'%null%' then ''
                 else segment end) as segment,
            (case when segment like '%1' then 'young adults' 
                 when segment like '%2' then 'middle aged'
                 when segment is null or segment like '%null%' then ''
                 else 'retirees'
            end) as age_band,
            (case when segment like 'C%' then 'couples'
                  when segment like 'F%' then 'families'
                  when segment is null or segment like '%null%' then ''
             end) as demographic, customer_type, transactions, sales, sales/transactions as avg_trans
    from 
        (select to_date(week_date,'dd-mm-yy') as week_date, region, platform, segment, customer_type, transactions, sales
        from data_mart.weekly_sales)t1) 
        
B. Data Exploration
1.What day of the week is used for each week_date value?
select (case when day = 1 then 'Monday'
             when day = 2 then 'Tuesday'
        	 when day = 3 then 'Wednesday'
        	 when day = 4 then 'thursday'
        	 when day = 5 then 'friday'
        	 when day = 6 then 'Saturday'
        	 when day = 0 then 'Sunday' end) as day
from         	 
(select extract(dow from week_date) as day 
from clean_weekly_sales) t1

2.What range of week numbers are missing from the dataset?
select range, count(range)
from 
      (select week_no, (case when week_no between 1 and 10 then '1-10'
                   when week_no between 11 and 20 then '11-20'
                   when week_no between 21 and 30 then '21-30'
                   when week_no between 31 and 40 then '31-40'
                   when week_no between 41 and 50 then '41-50'
                   when week_no between 51 and 60 then '51-60'end) as range
      from clean_weekly_sales) t1
group by range    
      
3.How many total transactions were there for each year in the dataset?
select calender_year, sum(transactions)
from clean_weekly_sales
group by calender_year
order by calender_year

4.What is the total sales for each region for each month?
select region, month_no, concat('$',sum(sales))
from clean_weekly_sales
group by region, month_no
order by region, month_no

5.What is the total count of transactions for each platform
/*same logic*/

6.What is the percentage of sales for Retail vs Shopify for each month?
select *, (select sum(sales) from clean_weekly_sales), concat(((sep*100)/(select sum(sales) from clean_weekly_sales)),'%') as percentage
from 
      (select platform, sum(sales) as sep
      from clean_weekly_sales
      group by platform
      order by platform) t1
      
7.What is the percentage of sales by demographic for each year in the dataset?
select demographic, calender_year, sum(sales), (select sum(sales) from clean_weekly_sales), 
		concat(((sum(sales)*100)/(select sum(sales) from clean_weekly_sales)),'%') as perc
from clean_weekly_sales 
group by demographic, calender_year
order by demographic, calender_year
      
8.Which age_band and demographic values contribute the most to Retail sales?
select demographic, age_band, sum(sales), (select sum(sales) from clean_weekly_sales),
	   ((sum(sales)*100)/(select sum(sales) from clean_weekly_sales))as percentage
from clean_weekly_sales
group by demographic, age_band 
order by percentage desc

9.Can we use the avg_transaction column to find the average transaction size for each year for Retail vs Shopify? If not - how would you calculate it instead?
/*qn not clear */

C) Before & After Analysis
1.What is the total sales for the 4 weeks before and after 2020-06-15? What is the growth or reduction rate in actual values and percentage of sales?
select *, ((cast(growth_red as float)*100)/sales_bef)as perc_growth
from
      (select *, (sales_after-sales_bef) as growth_red
      from        
          (select sum(case when week_no between 21 and 24 then sales end) as sales_bef,
                  sum(case when week_no between 26 and 29 then sales end) as sales_after
          from clean_weekly_sales
          where calender_year = '2020')t1)t2
         
2.What about the entire 12 weeks before and after?
/* same logic */

3.




